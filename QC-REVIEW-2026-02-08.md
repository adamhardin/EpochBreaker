# Epoch Breaker — QC Deep Review

**Date:** 2026-02-08
**Reviewer:** Codex (Round 1), Claude Opus (Round 2–5)
**Scope:** Full repo scan (docs, Unity project, scripts, build tooling, Game Design Agent). Round 2: critical visual regression. Round 3: combo/streak removal, stale HUD, L-shape. Round 4: dark rendering fix, HUD resize/frame, hazard block visual cues. Round 5: epoch border, HUD spacing, weapon name cleanup.

---

## ROUND 5 — Epoch Border, HUD Spacing, Weapon Name Cleanup

**Date:** 2026-02-08 (post Round 4)
**Status:** RESOLVED — three improvements

### Issue 1: Epoch-specific colored border

The static purple border (`Color(0.35, 0.30, 0.55)`) did not convey the current epoch's visual identity. Replaced with a **double-line retro border** (SNES-style) using the epoch's terrain accent color:

- **Outer line:** 3px, accent color brightened 30% (high contrast)
- **Inner line:** 2px, accent color at 50% brightness (depth effect)
- Total border thickness: ~6px per edge

Border colors per epoch (accent × 1.3):
- Stone Age: warm brown | Bronze Age: gold | Classical: red | Medieval: iron gray
- Renaissance: gold trim | Industrial: rust orange | Modern: warning yellow
- Digital: neon cyan | Spacefaring: plasma purple | Transcendent: white

Made `PlaceholderAssets.GetEpochTerrainColors()` public so `GameplayHUD` can access the accent color.

### Issue 2: Improved HUD spacing

Elements were cramped with inconsistent gaps. Applied 8px-grid spacing guidelines:

**Layout (two clear rows in bottom strip):**

| Row | Elements | Y Position |
|-----|----------|-----------|
| Top label | Difficulty badge ("HARD 2.0X") | y=108 |
| Top row | Hearts (185+i×40), Score (410), Timer (590), Era (right-aligned) | y=78–84 |
| Bottom row | Heat bar (185), Ability icons (410, 450), Lives (640), Relics (right-aligned) | y=24–44 |

Key spacing improvements:
- Hearts → Score: 25px gap (was 15px)
- Score → Timer: 30px gap (was 160px wasted)
- Ability icon gap: 40px (was 32px)
- All elements shifted to respect 12px inner padding from frame edge

### Issue 3: Removed redundant weapon name

The standalone weapon name text ("BOLT") in the bottom strip was redundant — the weapon wheel center label already displays the active weapon name and updates dynamically. Removed:
- `_weaponImg` and `_weaponSprite` field declarations
- Weapon name creation block in `CreateUI()`
- `UpdateWeaponDisplay()` text update logic (weapon wheel update still active)
- Quick Draw glow animation on `_weaponImg`
- Cleanup reference in `OnDestroy()`

### Files Modified in Round 5

| File | Changes |
|------|---------|
| `PlaceholderAssets.cs` | Changed `GetEpochTerrainColors()` from `private` to `public` |
| `GameplayHUD.cs` | Epoch double-line border; removed weapon name; repositioned all elements with 8px-grid spacing |
| `QC-REVIEW-2026-02-08.md` | Added Round 5 documentation |

---

## ROUND 4 — Dark Rendering Fix, HUD Resize, Hazard Block Cues

**Date:** 2026-02-08 (post Round 3)
**Status:** RESOLVED — three issues addressed

### Issue 1: Dark/invisible level rendering on reload

**Root cause:** Dual-layer sprite cache desync. `PlaceholderAssets.ClearCache()` (called in `StartLevel()`) destroys tile sprites keyed as `tile_{type}_e{epoch}` because the `IsSessionKey()` check did not include the `"tile_"` prefix. However, `TilemapRenderer` maintains its own static tile cache (`s_cachedTiles`, `s_cachedTileEpoch`) which holds references to those same sprites. When reloading the same epoch, `BuildTileAssets()` sees the epoch matches and reuses the cached `Tile` objects — but their sprites and textures have already been `Destroy()`ed by `ClearCache()`. Result: all tiles render as black/invisible. Enemies remain visible because they use a different sprite creation path.

**Why first load works:** On the initial load, sprites are alive in both caches. The bug only manifests on same-epoch reload because `ClearCache()` destroys sprites that `TilemapRenderer` still holds references to.

**Resolution:** Added `"tile_"` to the session-stable key list in `PlaceholderAssets.IsSessionKey()`. Tile sprites now survive `ClearCache()`, matching the intent of `TilemapRenderer.s_cachedTiles`. They are still cleaned up by `ClearAllCaches()` on session end / menu return.

**File:** `PlaceholderAssets.cs` — `IsSessionKey()` method

---

### Issue 2: HUD resize and frame

Resized the L-shaped HUD per user specifications:
- **Tall left column:** 150px → **175px** wide, 220px → **240px** tall
- **Bottom strip:** 110px → **125px** tall
- **Frame:** Added 2px border outline around both the tall column and bottom strip using a slightly lighter purple (`Color(0.35, 0.30, 0.55, 0.95)`) rendered behind the fill panels
- Repositioned all HUD elements (hearts, score, timer, era, difficulty badge, weapon name, heat bar, ability icons, special attack bar, lives counter, items) to account for the new dimensions
- Weapon wheel centered in wider column (x=88, y=145)
- Special attack bar widened to 140px, centered at x=88

**File:** `GameplayHUD.cs` — `CreateUI()`, `CreateHeatBar()`, `CreateSpecialAttackBar()`, `CreateAbilityIcons()`

---

### Issue 3: Hazard block visual cue

Destructible blocks containing hazards (FallingDebris, GasRelease, FireRelease, SpikeTrap, UnstableFloor, CoverWall) were visually indistinguishable from normal destructible blocks. Players had no way to anticipate hazard effects before breaking a block.

**Resolution:** Added `TintHazardTiles()` method to `TilemapRenderer`, following the established pattern used by `TintRelicTiles()` (gold) and `TintSentinelCaches()` (blue). Hazard blocks now receive a subtle red-orange tint (`Color(1.0, 0.7, 0.6, 1.0)`). Tiles already tinted as relics or sentinel caches are skipped to avoid overwriting higher-priority indicators.

**File:** `TilemapRenderer.cs` — added `TintHazardTiles()`, called from `RenderLevel()`

### Files Modified in Round 4

| File | Changes |
|------|---------|
| `PlaceholderAssets.cs` | Added `"tile_"` to `IsSessionKey()` session-stable prefixes |
| `GameplayHUD.cs` | Resized L-shape (175x240 tall column, 125px strip), added frame outlines, repositioned all HUD elements |
| `TilemapRenderer.cs` | Added `TintHazardTiles()` for hazard block visual cue |

### Round 2 Secondary Issues Status Update

| Issue | Status |
|-------|--------|
| `canvas.pixelPerfect = true` on all canvases | Still present — evaluate for layout jitter |
| Dynamic text creates/destroys textures every frame | Still present — mitigated by sprite cache |
| Tile sprite cache desync on same-epoch reload | **Resolved** — tile sprites now session-stable |

---

## ROUND 3 — Post-PPU-Fix Cleanup: Combo/Streak Removal, Reload Bug, HUD Reshape

**Date:** 2026-02-08 (post Round 2 fix)
**Status:** RESOLVED — three issues addressed

### Issues Identified

**Issue 1: Combo counter / kill streak UI is distracting**

After the PPU fix restored correct sizing, the combo counter ("X2 COMBO") and kill streak indicator ("X5") became visible at their intended size. User feedback: these are visually distracting and clutter the HUD.

**Resolution:** Removed all combo and kill streak visual components from `GameplayHUD.cs`:
- Removed fields: `_killStreakImg`, `_killStreakSprite`, `_killStreakFadeTimer`, `_lastKnownStreak`, `_comboImg`, `_comboSprite`
- Removed `UpdateKillStreak()` and `UpdateComboCounter()` methods and their `Update()` calls
- Removed creation blocks from `CreateUI()`
- Removed cleanup references from `OnDestroy()`

Note: The underlying combo/streak tracking in `GameManager` is untouched — only the HUD display was removed. These systems can be re-enabled later with a less intrusive visual treatment.

---

**Issue 2: Level reloads incorrectly after death (stale HUD state)**

**Root cause:** The previous update changed `DestroyUI()` to **hide** the HUD (`_hudObj.SetActive(false)`) instead of destroying it, and `CreateHUD()` to **reuse** a hidden HUD (`_hudObj.SetActive(true)`) if one existed. This meant static HUD elements — era name, epoch frame, difficulty badge, relic counter — were never refreshed on restart. After death → retry, the HUD displayed stale data from the previous attempt.

**Call chain on death:**
```
HealthSystem.Die() → GameManager.LoseLife() → TransitionTo(GameOver)
  → User clicks RETRY → StartGame() → TransitionTo(Loading) → StartLevel()
  → TransitionTo(Playing) → CreateHUD()  ← reused stale hidden HUD
```

**Resolution:** Reverted HUD lifecycle to always destroy and recreate:
- `DestroyUI()` now destroys `_hudObj` (sets `_hudObj = null`) instead of hiding it
- Removed `DestroyHUD()` method entirely (its behavior is now handled by `DestroyUI()`)
- `CreateHUD()` always creates a fresh HUD (removed the "reuse existing" check)
- `ResumeGame()` calls `CreateHUD()` instead of trying to re-show a hidden HUD
- Removed orphaned `DestroyHUD()` call from `ReturnToTitle()` (now redundant since `TransitionTo(TitleScreen)` → `DestroyUI()` handles cleanup)

**Trade-off:** HUD is now fully recreated after each pause/resume cycle. This is slightly more expensive than hide/show, but eliminates the stale state bug class entirely. The sprite cache in `PlaceholderAssets` means texture regeneration is minimal.

---

**Issue 3: HUD too short for content**

The single-strip HUD (110px tall at screen bottom) was too cramped to display scores, weapon info, and the weapon wheel comfortably.

**Resolution:** Reshaped HUD to an L-shape layout:
- **Tall left column:** 150px wide × 220px tall, anchored to bottom-left. Houses the weapon wheel (centered at y=130) and special attack bar.
- **Bottom strip:** Remaining width (right 50%), 110px tall. Houses score, timer, era info, and other status elements.
- Weapon wheel repositioned to y=130 (center of the tall column)
- Removed the epoch-themed HUD frame decoration (was using `Image.Type.Sliced` without proper slice borders — flagged as secondary issue in Round 2)

### Files Modified in Round 3

| File | Changes |
|------|---------|
| `GameplayHUD.cs` | Removed combo/streak UI; added L-shape layout (tall left column + bottom strip); repositioned weapon wheel |
| `GameManager.cs` | Reverted HUD lifecycle to destroy/recreate; removed `DestroyHUD()`; fixed `ResumeGame()` and `ReturnToTitle()` |

### Round 2 Secondary Issues Status Update

| Issue | Status |
|-------|--------|
| `canvas.pixelPerfect = true` on all canvases | Still present — evaluate for layout jitter |
| HUD frame sprite uses `Image.Type.Sliced` without borders | **Resolved** — frame decoration removed in Round 3 |
| Dynamic text creates/destroys textures every frame | Still present — mitigated by sprite cache |
| Damage popup system uses SetNativeSize | **Resolved** — fixed by Round 2 PPU fix |
| HUD hide vs destroy lifecycle | **Resolved** — reverted to destroy/recreate in Round 3 |

---

## ROUND 2 — CRITICAL REGRESSION: UI Text Sprites 100x Overscaled

**Date:** 2026-02-08 (post-update)
**Status:** SHOWSTOPPER — game unplayable
**Symptom:** Entire screen covered by massive colored rectangles. Game world barely visible behind oversized UI elements. Horizontal color bands (individual pixel rows of text characters blown up) fill 300-600% of screen dimensions.

### Root Cause (Confirmed)

**The `RenderPixelText` method in `PlaceholderAssets.cs` creates text sprites with `PPU = 1f` (pixels per unit). When these sprites are displayed via Unity `Image.SetNativeSize()`, Unity divides the sprite pixel dimensions by `Image.pixelsPerUnit`, which is computed as `sprite.pixelsPerUnit / canvas.referencePixelsPerUnit`. With sprite PPU=1 and canvas referencePixelsPerUnit=100 (Unity default, never overridden), this yields an effective `pixelsPerUnit` of 0.01. The result: every text sprite is displayed at 100x its intended size.**

**Detailed chain of failure:**

1. `PlaceholderAssets.RenderPixelText()` (line ~3746) creates sprites:
   ```
   Sprite.Create(tex, new Rect(0, 0, totalW, totalH), pivot, 1f)  // PPU = 1
   ```
2. All 14 UI scripts call `Image.SetNativeSize()` after assigning the sprite (~70 call sites)
3. Unity's `Image.SetNativeSize()` computes:
   ```
   effectivePPU = sprite.pixelsPerUnit / canvas.referencePixelsPerUnit = 1 / 100 = 0.01
   sizeDelta = (sprite.rect.width / 0.01, sprite.rect.height / 0.01) = dimensions * 100
   ```
4. A timer string "0:00.0" at scale=3 creates a 114x33 pixel texture, displayed as **11,400 x 3,300 canvas units** (594% x 306% of 1920x1080 reference)
5. An era card "ERA 1: STONE AGE" at scale=6 creates a 558x66 texture, displayed as **55,800 x 6,600 canvas units**

**Why this wasn't caught:** The previous code used `Text` components (Unity built-in font rendering) which have no PPU concept. The conversion to `Image` + pixel-art sprites introduced the PPU dependency, but the author set PPU=1f (appropriate for world-space SpriteRenderers but not for UI Images).

### Scope of Impact

**Files affected (14 scripts, ~70 `SetNativeSize()` call sites):**

| File | SetNativeSize Calls | Text Types |
|------|-------------------|------------|
| GameplayHUD.cs | 15 | Timer, score, weapon, era, combo, streaks, popups, damage numbers, achievements, boss name, mode info, items, pause, quick draw, DPS cap |
| TitleScreenUI.cs | 7 | Menu labels, subtitles, difficulty, volume %, settings, checkmarks |
| LevelCompleteUI.cs | 10 | Score header, stat rows, item counts, buttons, frame labels |
| CelebrationUI.cs | 3 | Title, narrative text, button labels |
| PauseMenuUI.cs | 6 | Menu items, difficulty, volume %, buttons |
| ChallengeEntryUI.cs | 6 | Labels, error messages, preview text, buttons |
| CosmeticSelectUI.cs | 6 | Preview labels, requirement text, buttons |
| AchievementsUI.cs | 3 | Achievement names, share button, labels |
| LegendsUI.cs | 2 | Legend entries, buttons |
| GameOverUI.cs | 2 | Title text, button labels |
| TouchControlsUI.cs | 2 | Action button labels (FIRE, JUMP, SWAP, V) |
| TutorialHintUI.cs | 2 | Hint text, arrow indicator |

**Also affected but NOT via SetNativeSize (use manual sizeDelta or Image.Type.Sliced):**
- `GetHUDFrameSprite` (480x110, PPU=1f) — used with `Image.Type.Sliced` and explicit `sizeDelta`, so NOT affected
- `GetOrnateFrameSprite` (1920x1080, PPU=1f) — used with anchors stretch-to-fill and explicit sizing, so NOT affected

### Concrete Example Calculations

| Text Content | Scale | Texture Size (px) | SetNativeSize Result | % of 1920x1080 |
|-------------|-------|-------------------|---------------------|----------------|
| "0:00.0" (timer) | 3 | 114 x 33 | 11,400 x 3,300 | 594% x 306% |
| "+500" (score popup) | 3 | 78 x 33 | 7,800 x 3,300 | 406% x 306% |
| "X5 COMBO" | 5 | 315 x 55 | 31,500 x 5,500 | 1641% x 509% |
| "ERA 1: STONE AGE" | 6 | 558 x 66 | 55,800 x 6,600 | 2906% x 611% |
| "12345" (score) | 4 | 132 x 44 | 13,200 x 4,400 | 688% x 407% |
| "25" (damage) | 3 | 42 x 33 | 4,200 x 3,300 | 219% x 306% |

### Fix Options (Ranked)

**Option A — Change PPU to 100f in RenderPixelText (RECOMMENDED)**

Change one line in `PlaceholderAssets.RenderPixelText()`:
```csharp
// Line ~3746: Change from:
return Sprite.Create(tex, new Rect(0, 0, totalW, totalH), new Vector2(0.5f, 0.5f), 1f);
// To:
return Sprite.Create(tex, new Rect(0, 0, totalW, totalH), new Vector2(0.5f, 0.5f), 100f);
```

- Fixes ALL 70+ call sites with a single line change
- Aligns sprite PPU with Unity's default `canvas.referencePixelsPerUnit` (100)
- `SetNativeSize()` will then compute: `114 / (100/100)` = 114 canvas units = correct
- No impact on world-space SpriteRenderers (pixel text sprites are never used in world space)
- Must also clear the sprite cache after fix to regenerate cached sprites with new PPU

**Option B — Replace SetNativeSize() with manual sizeDelta everywhere**

At every call site, replace:
```csharp
img.SetNativeSize();
```
With:
```csharp
rect.sizeDelta = new Vector2(sprite.rect.width, sprite.rect.height);
```

- Bypasses the PPU/referencePixelsPerUnit calculation entirely
- Requires changing ~70 call sites across 14 files
- More error-prone, higher chance of missing a site
- NOT recommended — treats symptom, not cause

**Option C — Set referencePixelsPerUnit = 1 on each CanvasScaler**

On every canvas:
```csharp
scaler.referencePixelsPerUnit = 1f;
```

- Would make the division `1/1 = 1`, so SetNativeSize works correctly
- But could break OTHER sprites that expect the default PPU=100 behavior
- Requires auditing every Image component in the game
- NOT recommended — risks side effects

**Recommendation: Option A.** Single-line fix, addresses root cause, zero side effects since pixel text sprites are exclusively used in UI Image components.

### Secondary Issues Found in This Update

1. **`canvas.pixelPerfect = true` added to all canvases** — While not the cause of the 100x scaling, this setting forces pixel-snapping which can cause layout jitter on non-integer positions. Should be evaluated after the PPU fix.

2. **HUD frame sprite uses `Image.Type.Sliced` without slice borders** — `GetHUDFrameSprite` creates a 480x110 sprite with PPU=1f and it's used as `Image.Type.Sliced`. Since the Sprite has no border metadata set via `Sprite.Create`, slicing will render incorrectly (stretched center, no preserved borders). This is cosmetic, not a blocker.

3. **Dynamic text `_UpdatePixelText` creates and destroys textures every frame** — Timer, score, weapon display, and other frequently-changing text regenerate entire textures each frame. This is a GC pressure source, though cleanup is properly handled.

4. **Damage popup system added without world-to-screen projection guard** — `HandleDamagePopup` calls `SetNativeSize()` on each damage number, making damage numbers 100x too large as well (same PPU bug).

5. **HUD lifecycle change (hide vs destroy on pause)** — `DestroyUI()` now hides the HUD instead of destroying it, and `ResumeGame()` re-shows it. This is correct behavior for performance, but the HUD's `_UpdatePixelText` continues running while hidden (no early-return check for `gameObject.activeInHierarchy`).

### What Else Changed in This Update (Non-UI)

- **Sentinel Cache system**: New destructible block type that spawns 4 homing missiles targeting nearby enemies. Added to `GameManager`, `TilemapRenderer`, `LevelGenerator`, `Projectile` (homing support), `EnemyBase`.
- **Auto-equip strongest weapon**: `WeaponSystem.AcquireWeapon` now auto-switches to the highest-DPS weapon on pickup.
- **Score multiplier**: Score now applies `DifficultyManager.ScoreMultiplier` before final calculation.
- **Audio tuning**: Low-pass filter parameters adjusted (cutoff 3000->2800, resonance 0.5->0.1).
- **New pixel font glyphs**: Added `+`, `,`, `(`, `)`, `>`, `%`, `$`, `<`, `=`, `#`, `?`, `_` to bitmap font.
- **MakeTex helper**: All `new Texture2D()` calls consolidated through `MakeTex()` for consistent `FilterMode.Point`.

---

## ROUND 1 — Original QC Review (unchanged below)

## Executive Summary

The core gameplay stack is coherent and feature-complete, but the repo has **significant documentation drift**, a few **build/test pipeline breakages**, and some **design-standard mismatches** (Level ID format, determinism rules, and UI bounds guidance). There are also several **gameplay/UI inconsistencies** stemming from recent design changes (campaign lives, randomize semantics), and a few **technical risks** (PlayerPrefs bloat, cosmetic tint overrides, runtime validation not invoked).

The highest-value fixes are to align docs with actual behavior, repair build tooling, and lock determinism rules so shared codes stay trustworthy.

---

## Design Standards Referenced

Primary sources checked for standards/constraints:
- `README.md`
- `QC-CHECKLIST.md`
- `docs/PROJECT-STRUCTURE.md`
- `docs/Level-Generation-Technical-Spec.md`
- `docs/Validation-QA-Suite.md`
- `docs/architecture-decisions/ADR-001..006.md`
- `ROADMAP.md`
- `EpochBreaker/ProjectSettings/ProjectVersion.txt`

---

## Findings

### Critical

None found that would immediately crash the game or corrupt saves in common flows.

### High

1. **Level ID format mismatch across code + docs.**
   - Code uses `E-XXXXXXXX` base32 (40-bit) format. `README` + `Level-Generation-Technical-Spec` + ADR-003 describe `LVLID_[VERSION]_[DIFFICULTY]_[ERA]_[SEED64]` (39 chars). QC checklist examples also use the short `3-K7XM2P9A` format.
   - Impact: Confuses users/testers, breaks cross-doc consistency, and undermines determinism claims.
   - Evidence:
     - `EpochBreaker/Assets/Scripts/Generative/LevelID.cs:7-15` (E-XXXXXXXX format)
     - `README.md:18-24, 134-140` (LVLID format)
     - `docs/Level-Generation-Technical-Spec.md:12-33` (LVLID format)
     - `docs/architecture-decisions/ADR-003-level-id-format.md` (LVLID format)
     - `QC-CHECKLIST.md:79-80` (3-K7XM2P9A)

2. **Documentation drift on engine version, repo structure, and CI.**
   - `docs/PROJECT-STRUCTURE.md` says Unity 2022.3 LTS, dual `unity_project/` mirror, and `.github/workflows/deploy-webgl.yml`. Actual project is Unity 6000.3.6f1 with no `unity_project/` and no `.github` workflow directory.
   - Impact: Onboarding confusion; wrong build/test instructions; broken automation assumptions.
   - Evidence:
     - `docs/PROJECT-STRUCTURE.md:9, 17-38`
     - `EpochBreaker/ProjectSettings/ProjectVersion.txt` (6000.3.6f1)
     - Repository root lacks `.github/` and `unity_project/`.

3. **Build pipeline script is broken.**
   - `scripts/test-and-build.sh` calls `BuildScript.BuildWebGL` and outputs to `WebGL-Build`, but `BuildScript.cs` only defines `PerformBuild()` and outputs to `build/WebGL/WebGL`.
   - Impact: Automated build step fails even when tests pass.
   - Evidence:
     - `scripts/test-and-build.sh:115-123`
     - `EpochBreaker/Assets/Scripts/Editor/BuildScript.cs:5-34`

4. **Design standard mismatch: validation tolerances and jump limits.**
   - Validation suite specifies max jump distance 4 tiles and difficulty tolerance ±1.0; validator uses 5 and ±1.5.
   - Impact: validation allows levels that violate the documented difficulty/physics envelope.
   - Evidence:
     - `docs/Validation-QA-Suite.md:63-75, 98-107`
     - `EpochBreaker/Assets/Scripts/Generative/LevelValidator.cs:34-46`

5. **Documented audio middleware (FMOD) not present.**
   - ADR-006 specifies FMOD Studio integration; codebase uses Unity AudioSources + synthesized clips.
   - Impact: architecture decisions are out of sync; team may plan workflows on incorrect assumptions.
   - Evidence:
     - `docs/architecture-decisions/ADR-006-audio-middleware.md`
     - `EpochBreaker/Assets/Scripts/Gameplay/AudioManager.cs`

6. **Security risk: `.env` not ignored.**
   - `Game Design Agent/.env` is a token-bearing file but `.gitignore` does not exclude `.env`.
   - Impact: accidental credential leakage in commits.
   - Evidence:
     - `.gitignore` (no `.env` or `Game Design Agent/.env` patterns)
     - `Game Design Agent/README.md` (explicit token use)

### Medium

1. **Campaign lives text/behavior mismatch.**
   - Campaign is now infinite lives (per Roadmap + code), but UI text still says “Start with 2 lives” and HUD displays `GlobalLives`.
   - Impact: Player-facing misinformation and confusing HUD.
   - Evidence:
     - `ROADMAP.md` (v1.1.0: campaign infinite lives)
     - `EpochBreaker/Assets/Scripts/Gameplay/GameManager.cs:1489-1536` (campaign infinite lives)
     - `EpochBreaker/Assets/Scripts/UI/TitleScreenUI.cs:1270-1276` (old text)
     - `EpochBreaker/Assets/Scripts/UI/GameplayHUD.cs:655-658` (shows `GlobalLives`)

2. **Randomize toggle semantics unclear/incorrect.**
   - `StartGame()` comment says “FreePlay: random epoch,” but it never sets `CurrentEpoch` randomly.
   - Impact: toggling Randomize doesn’t match user expectations.
   - Evidence: `EpochBreaker/Assets/Scripts/Gameplay/GameManager.cs:671-684`.

3. **Weapon Quick Draw glow overrides cosmetic tint.**
   - Quick Draw forces sprite color to `Color.white` (and resets to white), ignoring CosmeticManager skin tint.
   - Impact: cosmetics visually break during/after Quick Draw.
   - Evidence: `EpochBreaker/Assets/Scripts/Gameplay/Weapons/WeaponSystem.cs:84-97`.

4. **Potential PlayerPrefs bloat (ghost data, history).**
   - Ghost replay data stores raw position strings per level and has no size cap; level history stores up to 50 entries but ghosts are uncapped.
   - Impact: WebGL IndexedDB or mobile storage limits could be hit; longer load/save times.
   - Evidence:
     - `EpochBreaker/Assets/Scripts/Gameplay/GhostReplaySystem.cs:9-120`
     - `EpochBreaker/Assets/Scripts/Gameplay/GameManager.cs:1256-1292` (history)

5. **Runtime validation not enforced.**
   - `LevelValidator` is only used in editor tooling/tests; generation path does not run it or any post-fix validation beyond corridor clearing.
   - Impact: spec promises validation/repair, but runtime may ship invalid levels.
   - Evidence:
     - `EpochBreaker/Assets/Scripts/Generative/LevelGenerator.cs` (no validator call)
     - `EpochBreaker/Assets/Scripts/Editor/LevelValidator1000.cs`

6. **Walkable-path pass uses StartX/GoalX before they’re set.**
   - EnsureWalkablePath’s pass 3 uses `StartX`/`GoalX`, but those are set afterward.
   - Impact: extra-wide corridor clearing doesn’t apply to real start/goal columns.
   - Evidence:
     - `EpochBreaker/Assets/Scripts/Generative/LevelGenerator.cs:171-199`
     - `EpochBreaker/Assets/Scripts/Generative/LevelGenerator.cs:704-729`

7. **Determinism standard conflict (floating point layout).**
   - ADR-002 disallows floating point in layout decisions; generator uses floats extensively for proportions and intensity.
   - Impact: may cause cross-platform divergence if strict determinism is required.
   - Evidence:
     - `docs/architecture-decisions/ADR-002-deterministic-prng.md` (no float for layout)
     - `EpochBreaker/Assets/Scripts/Generative/LevelGenerator.cs` (float usage)

### Low

1. **UI bounds guidance conflict.**
   - QC checklist uses ±540/±960 bounds, while Project-Structure uses ±480/±900. One should be canonical.
   - Evidence:
     - `QC-CHECKLIST.md:29`
     - `docs/PROJECT-STRUCTURE.md:125-128`

2. **Build tooling duplication.**
   - Two WebGL build scripts exist (`BuildScript.cs` and `WebGLBuildScript.cs`) with different settings. This increases confusion.
   - Evidence: `EpochBreaker/Assets/Scripts/Editor/BuildScript.cs`, `EpochBreaker/Assets/Scripts/Editor/WebGLBuildScript.cs`.

3. **Heavy use of `FindAnyObjectByType`/`FindWithTag` in runtime loops.**
   - Generally cached, but still a performance footgun if references are frequently lost on transitions.
   - Evidence: multiple hits in `GameplayHUD.cs`, `EnemyBase.cs`, `HazardSystem.cs`, `Boss.cs`.

4. **WebGL template locks internal resolution to 1920x1080.**
   - Good for crispness, but may overwork low-end devices or small windows.
   - Evidence: `EpochBreaker/Assets/WebGLTemplates/EpochBreaker/index.html:34-74`.

---

## Compliance Gaps vs Documented Standards

- **Level ID Format**: Spec/ADR says `LVLID_...` (version/difficulty/era/seed64), code uses `E-XXXXXXXX` base32. See details above.
- **Determinism Rules**: ADR-002 forbids floating point for layout; current generator uses floats (proportions, intensity, density).
- **Validation Stage**: ADR-004 + README promise a validation/repair stage; runtime generator does not invoke `LevelValidator`.
- **Engine Version**: ADR-001 + PROJECT-STRUCTURE say Unity 2022 LTS; actual is 6000.3.6f1.
- **Audio Middleware**: ADR-006 specifies FMOD; code uses Unity native audio.
- **Platform Focus**: ROADMAP says mobile deprioritized; README still markets iOS target and mobile controls.
- **UI Bounds**: QC checklist vs Project-Structure bounds conflict.

---

## Recommendations (Prioritized)

1. **Resolve Level ID format decision.**
   - Pick the canonical format (short E-XXXXXXXX vs LVLID_...)
   - Update `README`, ADR-003, Technical Spec, QC checklist examples accordingly.

2. **Fix build script.**
   - Update `scripts/test-and-build.sh` to call the correct build method and output path.

3. **Align validation thresholds with spec (or update spec).**
   - Decide on jump constraints and difficulty tolerance; keep `LevelValidator` and `Validation-QA-Suite` in sync.

4. **Update documentation to match repo state.**
   - Remove references to `unity_project/` and `.github/workflows` if they’re intentionally gone.
   - Align engine version (6000.3.6f1) and platform focus (WebGL-first).

5. **Fix Campaign lives UX.**
   - Update About text, HUD, and any tooltips to match infinite lives behavior.
   - Consider removing extra life pickups or repurposing them (bonus score/heat reset).

6. **Preserve cosmetic tint through Quick Draw glow.**
   - Cache base tint and blend glow on top rather than overwriting to white.

7. **Cap or compress PlayerPrefs storage.**
   - Limit ghost samples per run or use a binary/quantized format with a max size.

---

## Creative Suggestions to Maximize Fun

1. **Destruction Echoes (High Fun / Low Code):**
   - When players break a structural group, trigger a short “echo” sound and screen rumble that scales with cascade depth. Makes big collapses feel legendary.

2. **Era-Specific “Signature Hazard” Moments:**
   - Add 1 unique hazard per era that teaches a micro-skill (e.g., Medieval: collapsing drawbridge; Industrial: steam vent that launches the player). Use tutorial hints the first time.

3. **Risk/Reward “Preservation Streak”:**
   - If the player completes 3 rooms in a row without destroying relic tiles, give a temporary precision buff (e.g., +10% auto-aim accuracy or +5% fire rate). Encourages strategic restraint.

4. **Boss Phase Callouts:**
   - Phase shift adds a 1-second “stinger” + telegraph text overlay (“PHASE 2: SHIELD UP”). It improves clarity and hype without changing mechanics.

5. **Weapon Synergy Bonuses:**
   - Add a small combo effect when two specific weapons are equipped (e.g., Piercer + Chainer = chain arcs ignore walls for 1 bounce). Keeps weapon cycling exciting.

6. **Daily Challenge Modifiers:**
   - Light modifiers (e.g., “Double hazards”, “No Cannon heat”, “Low gravity”) to keep daily content fresh.

---

## Test & QA Gaps

- No automated CI (GitHub Actions workflow missing). Smoke tests are not enforced in build pipeline.
- Level validation only exists in editor tooling; runtime does not validate or repair levels.
- UI layout QA relies on manual checklist; consider a simple automated snapshot or bounds check for key screens.

---

## Files Reviewed (Highlights)

- Gameplay systems: `GameManager.cs`, `LevelLoader.cs`, `PlayerController.cs`, `EnemyBase.cs`, `Boss.cs`, `WeaponSystem.cs`, `HealthSystem.cs`, `HazardSystem.cs`, `TilemapRenderer.cs`, `AudioManager.cs`, `PlaceholderAudio.cs`
- Generative systems: `LevelGenerator.cs`, `LevelValidator.cs`, `LevelID.cs`, `XORShift64.cs`
- UI: `TitleScreenUI.cs`, `GameplayHUD.cs`, `LevelCompleteUI.cs`, `PauseMenuUI.cs`, `AchievementsUI.cs`, `LegendsUI.cs`
- Editor/QA: `WebGLBuildScript.cs`, `BuildScript.cs`, `LevelValidator1000.cs`, tests under `EpochBreaker/Assets/Scripts/Tests/`
- Tooling: `deploy-webgl.sh`, `scripts/test-and-build.sh`
- Docs: `README.md`, `QC-CHECKLIST.md`, `ROADMAP.md`, `docs/*`, `ADR-001..006`
- Game Design Agent: `Game Design Agent/README.md`, `main.py`, `review_epochbreaker.py`, `requirements.txt`

